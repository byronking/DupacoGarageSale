@model DupacoGarageSale.Web.Models.GarageSaleViewModel

@{
    ViewBag.Title = "Welcome to the Dupaco Garage Sales!";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<style type="text/css">
    .nav-tabs li a {font-size:14px;padding: 13px 4px;color:#000000;}
</style>

<div class="container down_60">
    <div class="form-inline">
        <div class="form-group">
            <h1>Dupaco Community-Wide Garage Sales!</h1>
        </div>        
    </div><br />
    
    <p class="lead">
        Why garage sales? As a credit union, Dupaco is about people, thrift, and the community. That's also what the Community-Wide Garage Sale is about, and why it's a perfect 
        fit for us.
    </p>

    <!-- intro youtube video here -->
    <div class="row">
        <div class="embed-responsive embed-responsive-4by3">
            <iframe class="embed-responsive-item" allowfullscreen="" src="https://www.youtube.com/embed/GTOv0nxKcG4?rel=0"></iframe>
        </div>
    </div><br /><br />

    <p class="lead">
        Use the search tools below to find that perfect item.
    </p>
    <div class="row">
        <div id="results-filter" class="col-md-3">
            <p class="lead">Search all the garage sales</p>
            @using (Html.BeginForm("FilterResults", "Home", FormMethod.Post, new { @role = "form" }))
            {
                <input type="hidden" id="hdnSelectedCategories" value="@ViewBag.SelectedCategories" />
                <ul class="list-group">
                    <li class="list-group-item">
                        <div class="form-group">
                            @*<input type="text" id="txtSearchWithFilters" name="txtSearchWithFilters" class="form-control" placeholder="Enter search criteria" /> <br />*@
                            <select name="ddlRadius" id="ddlRadius" class="form-control">
                                <option value="5">5 miles</option>
                                <option value="10">10 miles</option>
                                <option value="15">15 miles</option>
                                <option value="25">25 miles</option>
                                <option value="50">50 miles</option>
                                <option value="100">100 miles</option>
                                <option value="250">250 miles</option>
                                <option value="500">500 miles</option>
                            </select>
                            <br />
                            <input type="hidden" id="hdnNoAddress" value="@ViewBag.NoAddress" />
                            <textarea class="form-control" id="txtAddress" name="txtAddress" placeholder="Enter an address or zip code">
                                @{
                                    if (TempData["UserAddress"] != null)
                                    {
                                        @TempData["UserAddress"].ToString() 
                                    }
                                }
                            </textarea>                       
                        </div><br />                            
                        <div>
                            <strong>Enter start and end dates:</strong><br />
                            <label for="from">Start:</label><br />
                            <input type="text" id="from" name="from" class="form-control"><br />
                            <label for="to">End:</label><br />
                            <input type="text" id="to" name="to" class="form-control"><br />
                        </div>
                        <br /><br />                          

                        <div id="accordion" class="panel-group" aria-multiselectable="true" role="tablist">
                            <div class="panel panel-success">
                            <div id="headingOne" role="tab" class="panel-heading">
                                <h4 class="panel-title">
                                <a aria-controls="collapseOne" aria-expanded="true" href="#collapseOne" data-parent="#accordion" data-toggle="collapse">
                                    Baby
                                </a>
                                </h4>
                            </div>
                            <div aria-labelledby="headingOne" role="tabpanel" class="panel-collapse collapse" id="collapseOne">
                                <div class="list-group">
                                    @{
                                        if (Model.ItemCategories != null)
                                        {
                                            var categories1 = Model.ItemCategories.Where(m => m.ItemCategoryId == 1);

                                            foreach (var category in categories1)
                                            {
                                                <div class="row" style="margin-left:5px;">
                                                    <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                                </div>
                                            }
                                        }
                                    }
                                </div>
                            </div>
                            </div>
                            <div class="panel panel-success">
                                <div id="headingTwo" role="tab" class="panel-heading">
                                    <h4 class="panel-title">
                                        <a aria-controls="collapseTwo" aria-expanded="false" href="#collapseTwo" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                                            Clothing & Accessories
                                        </a>
                                    </h4>
                                </div>
                                <div aria-labelledby="headingTwo" role="tabpanel" class="panel-collapse collapse" id="collapseTwo">
                                    <div class="list-group">
                                        @{
                                            if (Model.ItemCategories != null)
                                            {
                                                var categories2 = Model.ItemCategories.Where(m => m.ItemCategoryId == 2);

                                                foreach (var category in categories2)
                                                {
                                                    <div class="row" style="margin-left:5px;">
                                                        <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-success">
                            <div id="headingThree" role="tab" class="panel-heading">
                                <h4 class="panel-title">
                                <a aria-controls="collapseThree" aria-expanded="false" href="#collapseThree" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                                    Electronics
                                </a>
                                </h4>
                            </div>
                            <div aria-labelledby="headingThree" role="tabpanel" class="panel-collapse collapse" id="collapseThree">
                                <div class="list-group">
                                    @{
                                        if (Model.ItemCategories != null)
                                        {
                                            var categories3 = Model.ItemCategories.Where(m => m.ItemCategoryId == 3);

                                            foreach (var category in categories3)
                                            {
                                            <div class="row" style="margin-left:5px;">
                                                <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                            </div>
                                            }
                                        }
                                    }
                                </div>
                            </div>
                            </div>
                            <div class="panel panel-success">
                            <div id="headingFour" role="tab" class="panel-heading">
                                <h4 class="panel-title">
                                <a aria-controls="collapseFour" aria-expanded="false" href="#collapseFour" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                                    Health & Beauty
                                </a>
                                </h4>
                            </div>
                            <div aria-labelledby="headingFour" role="tabpanel" class="panel-collapse collapse" id="collapseFour">
                                <div class="list-group">
                                    @{
                                        if (Model.ItemCategories != null)
                                        {
                                            var categories4 = Model.ItemCategories.Where(m => m.ItemCategoryId == 4);

                                            foreach (var category in categories4)
                                            {
                                                <div class="row" style="margin-left:5px;">
                                                    <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                                </div>
                                            }
                                        }
                                    }
                                </div>
                            </div>
                            </div>
                            <div class="panel panel-success">
                                <div id="headingFive" role="tab" class="panel-heading">
                                    <h4 class="panel-title">
                                    <a aria-controls="collapseFive" aria-expanded="false" href="#collapseFive" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                                        Pets
                                    </a>
                                    </h4>
                                </div>
                                <div aria-labelledby="headingFive" role="tabpanel" class="panel-collapse collapse" id="collapseFive">
                                    <div class="list-group">
                                        @{
                                            if (Model.ItemCategories != null)
                                            {
                                                var categories5 = Model.ItemCategories.Where(m => m.ItemCategoryId == 5);

                                                foreach (var category in categories5)
                                                {
                                                    <div class="row" style="margin-left:5px;">
                                                        <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-success">
                                <div id="headingSix" role="tab" class="panel-heading">
                                    <h4 class="panel-title">
                                    <a aria-controls="collapseSix" aria-expanded="false" href="#collapseSix" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                                        Home
                                    </a>
                                    </h4>
                                </div>
                                <div aria-labelledby="headingSix" role="tabpanel" class="panel-collapse collapse" id="collapseSix">
                                    <div class="list-group">
                                        @{
                                            if (Model.ItemCategories != null)
                                            {
                                                var categories6 = Model.ItemCategories.Where(m => m.ItemCategoryId == 6);

                                                foreach (var category in categories6)
                                                {
                                                    <div class="row" style="margin-left:5px;">
                                                        <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-success">
                                <div id="headingSeven" role="tab" class="panel-heading">
                                    <h4 class="panel-title">
                                    <a aria-controls="collapseSeven" aria-expanded="false" href="#collapseSeven" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                                        Home Maintenance
                                    </a>
                                    </h4>
                                </div>
                                <div aria-labelledby="headingSeven" role="tabpanel" class="panel-collapse collapse" id="collapseSeven">
                                    <div class="list-group">
                                        @{
                                            if (Model.ItemCategories != null)
                                            {
                                                var categories7 = Model.ItemCategories.Where(m => m.ItemCategoryId == 7);

                                                foreach (var category in categories7)
                                                {
                                                    <div class="row" style="margin-left:5px;">
                                                        <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-success">
                                <div id="headingEight" role="tab" class="panel-heading">
                                    <h4 class="panel-title">
                                    <a aria-controls="collapseEight" aria-expanded="false" href="#collapseEight" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                                        Media
                                    </a>
                                    </h4>
                                </div>
                                <div aria-labelledby="headingEight" role="tabpanel" class="panel-collapse collapse" id="collapseEight">
                                    <div class="list-group">
                                        @{
                                            if (Model.ItemCategories != null)
                                            {
                                                var categories8 = Model.ItemCategories.Where(m => m.ItemCategoryId == 8);

                                                foreach (var category in categories8)
                                                {
                                                    <div class="row" style="margin-left:5px;">
                                                        <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-success">
                                <div id="headingNine" role="tab" class="panel-heading">
                                    <h4 class="panel-title">
                                    <a aria-controls="collapseNine" aria-expanded="false" href="#collapseNine" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                                        Toys & Games
                                    </a>
                                    </h4>
                                </div>
                                <div aria-labelledby="headingNine" role="tabpanel" class="panel-collapse collapse" id="collapseNine">
                                    <div class="list-group">
                                        @{
                                            if (Model.ItemCategories != null)
                                            {
                                                var categories9 = Model.ItemCategories.Where(m => m.ItemCategoryId == 9);

                                                foreach (var category in categories9)
                                                {
                                                    <div class="row" style="margin-left:5px;">
                                                        <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-success">
                                <div id="headingTen" role="tab" class="panel-heading">
                                    <h4 class="panel-title">
                                    <a aria-controls="collapseTen" aria-expanded="false" href="#collapseTen" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                                        Vehicles
                                    </a>
                                    </h4>
                                </div>
                                <div aria-labelledby="headingTen" role="tabpanel" class="panel-collapse collapse" id="collapseTen">
                                    <div class="list-group">
                                        @{
                                            if (Model.ItemCategories != null)
                                            {
                                                var categories10 = Model.ItemCategories.Where(m => m.ItemCategoryId == 10);

                                                foreach (var category in categories10)
                                                {
                                                    <div class="row" style="margin-left:5px;">
                                                        <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-success">
                                <div id="headingEleven" role="tab" class="panel-heading">
                                    <h4 class="panel-title">
                                    <a aria-controls="collapseEleven" aria-expanded="false" href="#collapseEleven" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                                        Sports, Fitness & Outdoors
                                    </a>
                                    </h4>
                                </div>
                                <div aria-labelledby="headingEleven" role="tabpanel" class="panel-collapse collapse" id="collapseEleven">
                                    <div class="list-group">
                                        @{
                                            if (Model.ItemCategories != null)
                                            {
                                                var categories11 = Model.ItemCategories.Where(m => m.ItemCategoryId == 11);

                                                foreach (var category in categories11)
                                                {
                                                    <div class="row" style="margin-left:5px;">
                                                        <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                            <div class="panel panel-success">
                                <div id="headingTwelve" role="tab" class="panel-heading">
                                    <h4 class="panel-title">
                                    <a aria-controls="collapseTwelve" aria-expanded="false" href="#collapseTwelve" data-parent="#accordion" data-toggle="collapse" class="collapsed">
                                         Musical Instruments & Gear
                                    </a>
                                    </h4>
                                </div>
                                <div aria-labelledby="headingTwelve" role="tabpanel" class="panel-collapse collapse" id="collapseTwelve">
                                    <div class="list-group">
                                        @{
                                            if (Model.ItemCategories != null)
                                            {
                                                var categories12 = Model.ItemCategories.Where(m => m.ItemCategoryId == 12);

                                                foreach (var category in categories12)
                                                {
                                                    <div class="row" style="margin-left:5px;">
                                                        <input type="checkbox" name="@category.ItemSubcategoryId" value="@category.ItemSubcategoryId"> <small>@category.ItemSubcategoryName</small>
                                                    </div>
                                                }
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <input type="submit" id="btnFilter" value="Search sales" class="btn btn-primary" />
                            <input type="button" id="btnClearSearch" value="Clear filters" class="btn btn-danger" />
                        </div>
                    </li>
                </ul>
            
                if (Model.SearchResults != null)
                {
                    var testy = ViewBag.SearchResults;

                    if (Model.SearchResults.GarageSaleItems.Count > 0)
                    {
                        <input type="hidden" name="hdnSearchCriteria" id="hdnSearchCriteria" value="@ViewBag.SearchCriteria" />
                    }
                    else
                    {                            
                        <input type="hidden" name="hdnSearchResults" id="hdnSearchResults" value="@ViewBag.SearchResults" /> <!-- This is the free text search string -->
                    }
                }
            }        
        </div>
        
        <div class="col-md-9">
            @using (Html.BeginForm("SearchByCriteria", "Home", FormMethod.Post, new { @class = "form-inline" }))
            {
                <div class="input-group">
                    <input class="form-control" type="text" id="txtSearchCriteria" name="txtSearchCriteria" style="width:275px" placeholder="What are you looking for?">
                    <span class="input-group-btn">
                        <input type="submit" id="btnSearchBarFind" class="btn btn-primary" value="Find it!" />
                    </span>
                </div><br /><br />
            }

            <div id="searchValidation" class="hidden alert alert-danger fade in" role="alert" style="width:444px;">
                <strong>Oops!</strong>
                Please enter search criteria.
            </div>

            <input type="hidden" id="hdnSearchBarCriteria" value="@ViewBag.SearchCriteria" />
            <input type="hidden" id="hdnShowMap" value="@ViewBag.ShowMap" />                
            <input type="hidden" id="hdnSearchResultsCount" value="@ViewBag.SearchResultsCount" />
            
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row">
                        <!-- Here's the map -->
                        <div id="map-canvas" style="width: 100%; height: 565px; margin-bottom:20px;"></div>
                    </div>

                    <!-- This shows the search results -->
                    @if (Model.SearchResults != null)
                    {
                        if (Model.SearchResults.SpecialItems.Count != 0 || Model.SearchResults.GarageSaleItems.Count != 0)
                        {
                            <div class="row">
                                @if (Model.SearchResults.SpecialItems.Count != 0)
                                {
                                    <div>
                                        <p class="lead" style="margin-left:18px;">Hot picks</p>
                                        @foreach (var item in Model.SearchResults.SpecialItems)
                                        {
                                            <div class="col-md-5">
                                                <div class="thumbnail" style="max-height:600px;min-height:550px;">
                                                    <a href="~/Content/images/garage_sale_pictures/@item.PictureLink" data-lightbox="@item.PictureLink">
	                                                    <img alt="@item.Title" class="img-responsive" style="display:block;max-height:200px;" src="~/Content/images/garage_sale_pictures/@item.PictureLink">
                                                    </a> 
                                                    <div class="caption">
                                                        <h3>@item.Title</h3>
                                                        @item.Description<br /><br />
                                                        <p><span>$</span> @item.Price</p>
                                                        @item.SpecialItemAddress.Address1<br />
                                        
                                                        @if (@item.SpecialItemAddress.Address2 != string.Empty)
                                                        {
                                                            @item.SpecialItemAddress.Address2<br />
                                                        }

                                                        @item.SpecialItemAddress.City, @item.SpecialItemAddress.State @item.SpecialItemAddress.ZipCode<br /><br />
                                                        <a href="~/GarageSale/ViewGarageSale/@item.SaleId">Visit this garage sale</a><br />                  
                                                    </div>                     
                                                </div>
                                            </div>
                                        }                                        
                                    </div>
                                }
                            </div>

                            if (Model.SearchResults.SpecialItems.Count != 0 && Model.SearchResults.GarageSaleItems.Count != 0)
                            {
                             <hr/>   
                            }

                            if (Model.SearchResults.GarageSaleItems.Count != 0)
                            {                                
                            <div style="width:60%;">
                                <!-- Diaplay the garage sale items -->
                                <p class="lead">Garage sale items for sale</p>
                                @(Html.Telerik().Grid(Model.SearchResults.GarageSaleItems)
                                    .Name("grdGarageSaleItems")
                                    .DataKeys(dataKeys => dataKeys.Add(k => k.GarageSaleItemsId))
                                    .Columns(columns =>
                                    {
                                        columns.Command(commands =>
                                        {
                                            commands.Custom("ViewGarageSale")
                                                .Text("View")
                                                .Action("ViewGarageSale", "GarageSale")
                                                .DataRouteValues(route =>
                                                {
                                                    route.Add(m => m.SaleId).RouteKey("saleId");
                                                });
                                        });
                                    })
                                    .RowTemplate(grid => @<text>
				                        <div>
                                            @if (item.ProfilePic == string.Empty)
                                            {
                                                <a href="~/Content/images/profile_pictures/keep-calm-and-come-to-the-dupaco-garage-sale.png" data-lightbox="dupaco_garage_sale">
                                                    <img class="img-circle" style="width:75px;height:75px" src="~/Content/images/profile_pictures/keep-calm-and-come-to-the-dupaco-garage-sale.png" />
                                                </a>
                                            }
                                            else
                                            {
                                                <a href="~/Content/images/profile_pictures/@item.ProfilePic" data-lightbox="dupaco_garage_sale">
                                                    <img class="img-circle" style="width:75px;height:75px" src="~/Content/images/profile_pictures/@item.ProfilePic" />
                                                </a>
                                            }<br /><br />
                                            @item.SaleDescription<br /><br />
                                            @item.ItemCategoryName - @item.ItemSubcategoryName<br /><br />                                                                                                
					                        <span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span> @item.Address1,
					                        @if (item.Address2 != string.Empty)
                                            {                        
						                        @item.Address2
                                            }
					                        @item.City, @item.State @item.ZipCode<br /><br />
					                        <a href="~/GarageSale/ViewGarageSale/@item.SaleId">Visit this garage sale</a><br />
				                        </div>
                                    
                                    </text>
                                    )
                                    .Pageable(pager => pager.PageSize(5))
                                    .Sortable()
                                )
                            </div>
                            }
                        }
                        else
                        {
                            <div class="alert alert-danger" role="alert" style="width:50%;">
                                <strong>Oh no!</strong>
                                No results found!
                            </div>
                        }
                    }                    

                    <div class="row">
                        <!-- This shows the featured hot picks for the home page. -->
                        @if (Model.GarageSaleSpecialItems != null && Model.SearchResults == null)
                        {
                            if (Model.GarageSaleSpecialItems.Count > 0)
                            {
                                <p class="lead" style="margin-left:17px;">Featured hot picks</p>
                                foreach (var item in Model.GarageSaleSpecialItems)
                                {
                                    <div class="col-md-5">
                                        <div class="thumbnail" style="max-height:600px;min-height:550px;">
                                            <a href="~/Content/images/garage_sale_pictures/@item.PictureLink" data-lightbox="@item.PictureLink">
	                                            <img alt="@item.Title" class="img-responsive" style="display:block;max-height:200px;" src="~/Content/images/garage_sale_pictures/@item.PictureLink">
                                            </a>                                                
                                            <div class="caption">
                                                <h3>@item.Title</h3>
                                                @item.Description<br /><br />
                                                <p><span>$</span> @item.Price</p>
                                                @item.SpecialItemAddress.Address1<br />
                                        
                                                @if (@item.SpecialItemAddress.Address2 != string.Empty)
                                                {
                                                    @item.SpecialItemAddress.Address2<br />
                                                }

                                                @item.SpecialItemAddress.City, @item.SpecialItemAddress.State @item.SpecialItemAddress.ZipCode<br /><br />
                                                <a href="~/GarageSale/ViewGarageSale/@item.SaleId">Visit this garage sale</a><br />                  
                                            </div>                     
                                        </div>
                                    </div>
                                }
                            }
                        }
                    </div>
                    <div class="row">
                        <!-- This shows random garage sale items for the home page. -->
                        @if (Model.GarageSaleItems != null && Model.SearchResults == null)
                        {
                            if (Model.GarageSaleItems.Count > 0)
                            {
                                <p class="lead" style="margin-left:17px;">Garage sale items for sale</p>
                                    @(Html.Telerik().Grid(Model.GarageSaleItems)
                                        .Name("grdRandomGarageSaleItems")
                                        .DataKeys(dataKeys => dataKeys.Add(k => k.GarageSaleItemsId))
                                        .Columns(columns =>
                                        {
                                            columns.Command(commands =>
                                            {
                                                commands.Custom("ViewGarageSale")
                                                    .Text("View")
                                                    .Action("ViewGarageSale", "GarageSale")
                                                    .DataRouteValues(route =>
                                                    {
                                                        route.Add(m => m.SaleId).RouteKey("saleId");
                                                    });
                                            });
                                        })
                                        .RowTemplate(grid => @<text>
				                            <div>
                                                @if (item.ProfilePic == string.Empty)
                                                {
                                                    <a href="~/Content/images/profile_pictures/keep-calm-and-come-to-the-dupaco-garage-sale.png" data-lightbox="dupaco_garage_sale">
                                                        <img class="img-circle" style="width:75px;height:75px" src="~/Content/images/profile_pictures/keep-calm-and-come-to-the-dupaco-garage-sale.png" />
                                                    </a>
                                                }
                                                else
                                                {
                                                    <a href="~/Content/images/profile_pictures/@item.ProfilePic" data-lightbox="dupaco_garage_sale">
                                                        <img class="img-circle" style="width:75px;height:75px" src="~/Content/images/profile_pictures/@item.ProfilePic" />
                                                    </a>
                                                }
                                                <br /><br />
                                                @item.SaleDescription<br /><br />
                                                @item.ItemCategoryName - @item.ItemSubcategoryName<br /><br />
					                            <span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span> @item.Address1,
					                            @if (item.Address2 != string.Empty)
                                                {                        
						                            @item.Address2
                                                }
					                            @item.City, @item.State @item.ZipCode<br /><br />
					                            <a href="~/GarageSale/ViewGarageSale/@item.SaleId">Visit this garage sale</a><br />
				                            </div>
                                    
                                        </text>
                                        )
                                        .Pageable(pager => pager.PageSize(5))
                                        .Sortable()
                                    )
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<input type="hidden" value="@ViewBag.SearchAddress" id="hdnSearchAddress" />
<input type="hidden" value="@ViewBag.Radius" id="hdnRadius" />

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC0PudWjsqLxR5ZBsdLIBHUjMikiAZJgu8"></script>
<script type="text/javascript">     
   
    var mapAddresses = @Html.Raw(new System.Web.Script.Serialization.JavaScriptSerializer().Serialize(ViewBag.Addresses))
    //alert('addys: ' + mapAddresses);

    var geocoder;
    var circle = null;
    var gmarkers = [];

    function initialize() {
        // Begin simple test map
        //var latlng = new google.maps.LatLng(40.716948, -74.003563);
        //var options = {
        //    zoom: 14,
        //    center: latlng,
        //    mapTypeId: google.maps.MapTypeId.ROADMAP
        //};
        //var map = new google.maps.Map(document.getElementById("map-canvas"), options);
        // End simple test map

        geocoder = new google.maps.Geocoder();
        //alert(geocoder);

        var map;         

        var myOptions = {
            zoom: 8,
            center: new google.maps.LatLng(39.329102, -76.576853),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map($('#map-canvas')[0], myOptions);

        // Sample of hard-coded addresses
        //var addresses = ['7 Saint Paul St. Baltimore MD 21202', '2201 Lake Ave Baltimore MD 21213', '4846 Western Ave Bethesda MD 20816', '201 State Rd Rehoboth DE 19971', '2804 Hyson Lane Falls Church VA 22043'];

        var addresses = mapAddresses;

        if (addresses != null)
        {
            var marker, x;
            var infowindow = new google.maps.InfoWindow();

            for (x = 0; x < addresses.length; x++) {
                $.getJSON('http://maps.googleapis.com/maps/api/geocode/json?address=' + addresses[x] + '&sensor=false', null, function (data) {

                    var p = data.results[0].geometry.location

                    //alert(data.results[0].formatted_address);  // This will alert the individual addresses.

                    //debugObject(data.results[0].formatted_address);
                    var latlng = new google.maps.LatLng(p.lat, p.lng);
                    var marker = new google.maps.Marker({
                        position: latlng,
                        map: map,
                        title: data.results[0].formatted_address
                    });

                    // Add the markers to the gmarkers array.
                    gmarkers.push(marker);

                    google.maps.event.addListener(marker, 'click', function () {
                        infowindow.setContent(data.results[0].formatted_address + ' <br/><a href="~/GarageSale/GetGarageSaleByAddress?address='+ data.results[0].formatted_address + '">Visit this sale</a>');
                        infowindow.open(map, marker);
                    });
                });            
            }

            geoCodeAddress(map);

            // Jump to the map.
            //window.location = $('#mappy').attr('href');
        }
    }    

    initialize();

    function geoCodeAddress(map) {
        var address = document.getElementById('hdnSearchAddress').value;
        var radius = parseInt(document.getElementById('hdnRadius').value, 10)*1000;
        //var address = document.getElementById("hdnCenterAddress").value;

        geocoder.geocode({ 'address': address }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) 
            {
                map.setCenter(results[0].geometry.location);
                var searchCenter = results[0].geometry.location; // Added for the radius circle.
                var marker = new google.maps.Marker({
                    map: map,
                    position: results[0].geometry.location
                });

                var infowindow = new google.maps.InfoWindow();
                google.maps.event.addListener(marker, 'click', function () {
                    infowindow.setContent('Your starting point: ' + results[0].formatted_address);
                    infowindow.open(map, marker);
                });

                if (circle) 
                {
                    circle.setMap(null); // Clear the previous circle.
                }

                circle = new google.maps.Circle({center:searchCenter,
                    radius: radius,
                    fillOpacity: 0.35,
                    fillColor: "#FF0000",
                    map: map
                });

                //alert('zoom: ' + map.getZoom());

                var bounds = new google.maps.LatLngBounds();

                var foundMarkers = 0;
                for (var i=0; i<gmarkers.length;i++) 
                {
                    if (google.maps.geometry.spherical.computeDistanceBetween(gmarkers[i].getPosition(),searchCenter) < radius) {
                        bounds.extend(gmarkers[i].getPosition())
                        gmarkers[i].setMap(map);
                        // add a line to the side_bar html
                        //side_bar_html += '<a href="javascript:myclick(' + i + ')">' + gmarkers[i].title + '<\/a><br>';
                        foundMarkers++;
                    } 
                    else 
                    {
                        gmarkers[i].setMap(null);
                    }
                }
                // put the assembled side_bar_html contents into the side_bar div
                //document.getElementById("side_bar").innerHTML = side_bar_html;
                if (foundMarkers > 0) 
                {
                    map.fitBounds(bounds);
                    //alert('zoom: ' + map.getZoom());
                    //map.setZoom(map.getZoom()+5);
                } 
                else 
                {
                    //alert('zoom else: ' + map.getZoom());
                    map.fitBounds(circle.getBounds());
                }
                // makeSidebar();
                google.maps.event.addListenerOnce(map, 'bounds_changed', makeSidebar);
            }
            else
            {
                // alert("Geocode was not successful for the following reason: " + status);
            }            
        });
    }

    function debugObject(inputobject) {
        obj = inputobject;
        for (x in obj) {
            alert(x + ": " + obj[x]);
        }
    }

</script>