@model DupacoGarageSale.Data.Domain.GarageSaleUser

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a class="navbar-brand" href="~/Home/">Garage Sale User Profile</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="@ViewBag.NavProfile"><a href="~/Accounts/UserProfile/@Model.UserId">My profile</a></li>
                <li class="dropdown @ViewBag.NavGarageSales">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Garage sales <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="~/GarageSale/Add/">Add a new sale</a></li>
                        <li><a href="~/GarageSale/View/">View my sales</a></li>
                    </ul>
                </li>
                <li class="@ViewBag.NavSearch"><a href="~/GarageSale/Search?s=1">Search</a></li>
                @if(Model.Address.AddressId != 0)
                {
                    <li class="@ViewBag.NavCreateItinerary"><a href="~/GarageSale/ViewItinerary/@Model.UserId">View itinerary</a></li>
                }
                <li><a href="~/Accounts/SignUp/">Create new account</a></li>
            </ul>
            <form class="navbar-form navbar-right" role="form">
                <div class="form-group">
                    <button class="btn btn-primary">Signed in as @Model.FirstName @Model.LastName</button>
                    @Html.ActionLink("Log out", "LogOut", "Home", null, new { @class="btn btn-success", @id="btnLogOut" })                    
                </div>
                <div class="form-group" style="display:none;">
                    @*<div class="fb-login-button" id="loginbutton" data-max-rows="1" data-size="large" data-show-faces="false" data-auto-logout-link="true" onlogout="" onlogin='window.location.reload(true);'></div>*@
                    <fb:login-button autologoutlink="false"></fb:login-button>
                    <div id="fb-root"></div>
                </div>
            </form>
        </div>
    </div>
</nav>

<script>
    window.fbAsyncInit = function () {
        FB.init({
            appId: '1538676693053081',
            xfbml: true,  // parse social plugins on this page.  default is true.
            version: 'v2.1' // use version 2.1
        });

        FB.Event.subscribe('auth.authResponseChange', auth_response_change_callback);
        FB.Event.subscribe('auth.statusChange', auth_status_change_callback);
    };

    // Load the SDK asynchronously
    (function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js"; // Use this one for prod.
        //js.src = "//connect.facebook.net/en_US/sdk/debug.js";
        fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    var auth_response_change_callback = function (response) {
        console.log("auth_response_change_callback");
        console.log(response);
    }

    var auth_status_change_callback = function (response) {
        console.log("auth_status_change_callback: " + response.status);

        if (response.status === 'unknown') {
            location.href = '/Home/LogOut';
        }
    }

    function debugObject(inputobject) {
        obj = inputobject;
        for (x in obj) {
            alert(x + ": " + obj[x]);
        }
    }
</script>